<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-v0.2.0/tutorials/application-migration" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Application Migration | Kosmos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kosmos-io.github.io/website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kosmos-io.github.io/website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kosmos-io.github.io/website/v0.2.0/tutorials/application-migration"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Application Migration | Kosmos"><meta data-rh="true" name="description" content="Kosmos provides application migration functionality to help users migrate existing applications from subclusters to the Kosmos control plane cluster."><meta data-rh="true" property="og:description" content="Kosmos provides application migration functionality to help users migrate existing applications from subclusters to the Kosmos control plane cluster."><link data-rh="true" rel="icon" href="/website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/application-migration"><link data-rh="true" rel="alternate" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/application-migration" hreflang="en"><link data-rh="true" rel="alternate" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/application-migration" hreflang="x-default"><link rel="stylesheet" href="/website/assets/css/styles.e896f8c2.css">
<script src="/website/assets/js/runtime~main.a16ccbac.js" defer="defer"></script>
<script src="/website/assets/js/main.184346e0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/website/"><div class="navbar__logo"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kosmos</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/website/v0.2.0/getting-started/introduction">Documentation</a><a class="navbar__item navbar__link" href="/website/blog">Examples</a><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/getting-started/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/quick-start">Quick Start</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mcs-discovery">Multi-cluster Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mc-scheduler">Multi-cluster Scheduler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mcn-connectivity">Multi-cluster Network Connectivity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/pv-pvc-dynamic-storage">Multi-cluster PV/PVC Dynamic Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/exe-and-log">Design of EXE and Log in Kosmos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/node-not-ready">Kosmos Node NotReady</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/ipsec-network">IPsec Cross-cluster Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/website/v0.2.0/tutorials/application-migration">Application Migration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/k8s-in-k8s">Kubernetes in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/distribution-policy">Distribution Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/leaf-node-generate-rules">Leaf Node Generate Rules</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Application Migration</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Application Migration</h1>
<p>Kosmos provides application migration functionality to help users migrate existing applications from subclusters to the Kosmos control plane cluster.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="application-migration-solution">Application Migration Solution<a href="#application-migration-solution" class="hash-link" aria-label="Direct link to Application Migration Solution" title="Direct link to Application Migration Solution">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h3>
<p>In the Kosmos multi-cluster design architecture, users can interact with the kube-apiserver of the control plane cluster using tools such as kubectl and client-go to create deployments or statefulset applications, etc.
The actual Pod instances are running in the subclusters.</p>
<p>However, for existing applications in the subclusters that were not created through the Kosmos control plane, these applications cannot be viewed and managed in the control plane cluster.</p>
<p>Kosmos provides application migration functionality to support the migration of applications in a namespace to the control plane cluster.
The entire process does not require restarting the application Pod instances, ensuring minimal impact on business operations.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="design-details">Design Details<a href="#design-details" class="hash-link" aria-label="Direct link to Design Details" title="Direct link to Design Details">​</a></h3>
<p>Application migration mainly consists of three processes: application backup -&gt; deletion of owner objects -&gt; rebuilding applications in the control plane.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="application-backup">Application Backup<a href="#application-backup" class="hash-link" aria-label="Direct link to Application Backup" title="Direct link to Application Backup">​</a></h4>
<p>Kosmos first backs up all namespaced-level resources in the target namespace, as well as the dependent cluster-level resources, such as cluster roles, cluster role bindings, persistent volumes, etc.
The backup files are stored in PVCs in Kosmos.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="deletion-of-owner-objects">Deletion of Owner Objects<a href="#deletion-of-owner-objects" class="hash-link" aria-label="Direct link to Deletion of Owner Objects" title="Direct link to Deletion of Owner Objects">​</a></h4>
<p>The subclusters in Kosmos only run Pods, and their owner StatefulSets or ReplicaSets need to be deleted and rebuilt in the Kosmos control plane.
Similarly, the owner Deployment of a ReplicaSet, as well as the owner StatefulSet and Deployment, need to be deleted and rebuilt in the Kosmos control plane.</p>
<p>By using a top-down cascading deletion of owner objects (e.g., deleting the Deployment first and then the ReplicaSet), the Pods are not affected and remain in a running state.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rebuilding-applications-in-the-control-plane">Rebuilding Applications in the Control Plane<a href="#rebuilding-applications-in-the-control-plane" class="hash-link" aria-label="Direct link to Rebuilding Applications in the Control Plane" title="Direct link to Rebuilding Applications in the Control Plane">​</a></h4>
<p>Based on the backup resources, the control plane cluster creates all the migrated resources, including namespaces, pods, deployments, config maps, service accounts, etc.
In order to maintain consistency with the subcluster Pods and keep them in a running state, the applications are rebuilt using a bottom-up approach (e.g., creating the Pod first and then the ReplicaSet).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="crd-api">CRD API<a href="#crd-api" class="hash-link" aria-label="Direct link to CRD API" title="Direct link to CRD API">​</a></h4>
<p>The PromotePolicy CRD API is provided for configuring the migration policy.
PromotePolicy is a cluster-wide CRD API. Here is an example of how to use it:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: kosmos.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PromotePolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: promote-policy-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  includedNamespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - namespace1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - namespace2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  excludedNamespaceScopedResources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - events.events.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - endpointslices.discovery.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterName: member-cluster1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where:</p>
<ul>
<li>includedNamespaces: The namespaces to be migrated.</li>
<li>excludedNamespaceScopedResources: The namespace-level resources that should not be migrated.
It is recommended to keep the example configuration and add additional configurations as needed based on actual requirements.</li>
<li>clusterName: The name of the Kosmos subcluster.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rollback">Rollback<a href="#rollback" class="hash-link" aria-label="Direct link to Rollback" title="Direct link to Rollback">​</a></h4>
<p>Kosmos supports rollback functionality for migrations.
After a successful migration, the existing applications in the subcluster can be restored to their initial state.
Simply edit the PromotePolicy YAML file and add the configuration &#x27;rollback&#x27;=true.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: kosmos.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PromotePolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: promote-policy-sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rollback: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  includedNamespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - namespace1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - namespace2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  excludedNamespaceScopedResources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - events.events.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - endpointslices.discovery.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterName: member-cluster1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-plans">Test Plans<a href="#test-plans" class="hash-link" aria-label="Direct link to Test Plans" title="Direct link to Test Plans">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="preparation">Preparation<a href="#preparation" class="hash-link" aria-label="Direct link to Preparation" title="Direct link to Preparation">​</a></h4>
<p>First, you need to deploy <a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer">Kosmos</a> (the clustertree module must be installed) and add a subcluster.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-existing-application-in-the-subcluster">Create an Existing Application in the Subcluster<a href="#create-an-existing-application-in-the-subcluster" class="hash-link" aria-label="Direct link to Create an Existing Application in the Subcluster" title="Direct link to Create an Existing Application in the Subcluster">​</a></h4>
<p>Deploy an nginx application in the subcluster as an example.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: nginx-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      deletionGracePeriodSeconds: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: nginx:1.14-alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - containerPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: nginx-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: nginx-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app: nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    targetPort: 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: ClusterIP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-migration-policy">Create a Migration Policy<a href="#create-a-migration-policy" class="hash-link" aria-label="Direct link to Create a Migration Policy" title="Direct link to Create a Migration Policy">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># kubectl apply -f promote-nginx.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: kosmos.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PromotePolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: promote-policy-example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  includedNamespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - nginx-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  excludedNamespaceScopedResources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - events.events.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - endpointslices.discovery.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterName: cluster-36-28</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="check-the-migration-result">Check the Migration Result<a href="#check-the-migration-result" class="hash-link" aria-label="Direct link to Check the Migration Result" title="Direct link to Check the Migration Result">​</a></h4>
<p>Check the progress of the migration:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># kubectl describe promotepolicy promote-policy-example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name:         promote-policy-example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace:    default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels:       &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations:  &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">API Version:  kosmos.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Kind:         PromotePolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Creation Timestamp:  2024-03-11T10:57:47Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Generation:          3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Resource Version:  405947183</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UID:               0e32dd93-c370-4874-b9a7-37a6894cd373</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Cluster Name:  cluster-36-28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Excluded Namespace Scoped Resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    events.events.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    endpointslices.discovery.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    controllerrevisions.apps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Included Namespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Backedup File:  /data/backup/promote-policy-sample20240311-104907</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Phase:          Completed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Events:           &lt;none&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When Status.Phase is &#x27;Completed&#x27;, it means the migration is successful. At this point, you can view and manage all applications in the nginx-test namespace in the control plane cluster.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rollback-1">Rollback<a href="#rollback-1" class="hash-link" aria-label="Direct link to Rollback" title="Direct link to Rollback">​</a></h4>
<p>Edit the promote-nginx.yml file and add the configuration ‘rollback’=true:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># kubectl apply -f promote-nginx.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: kosmos.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PromotePolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: promote-policy-example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rollback: &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  includedNamespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - nginx-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  excludedNamespaceScopedResources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - events.events.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - endpointslices.discovery.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  clusterName: cluster-36-28</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Check the rollback result:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># kubectl describe promotepolicy promote-policy-example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name:         promote-policy-example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace:    default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels:       &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations:  &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">API Version:  kosmos.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Kind:         PromotePolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Creation Timestamp:  2024-03-11T10:57:47Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Generation:          5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Resource Version:  405953692</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UID:               0e32dd93-c370-4874-b9a7-37a6894cd373</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Cluster Name:  cluster-36-28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Excluded Namespace Scoped Resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    events.events.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    endpoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    endpointslices.discovery.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    controllerrevisions.apps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Included Namespaces:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nginx-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Backedup File:  /data/backup/promote-policy-sample20240311-104907</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Phase:          RolledBack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Events:           &lt;none&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When Status.Phase is &#x27;RolledBack&#x27;, it means the rollback is successful.
At this point, the applications in the nginx-test namespace cannot be queried in the control plane cluster.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/v0.2.0/tutorials/application-migration.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/website/v0.2.0/tutorials/ipsec-network"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">IPsec Cross-cluster Network</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/website/v0.2.0/proposals/k8s-in-k8s"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kubernetes in Kubernetes</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#application-migration-solution" class="table-of-contents__link toc-highlight">Application Migration Solution</a><ul><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#design-details" class="table-of-contents__link toc-highlight">Design Details</a></li><li><a href="#test-plans" class="table-of-contents__link toc-highlight">Test Plans</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Address Name<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>