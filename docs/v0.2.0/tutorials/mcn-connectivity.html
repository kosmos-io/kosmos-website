<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-v0.2.0/tutorials/mcn-connectivity" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Multi-cluster Network Connectivity | Kosmos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kosmos-io.github.io/website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kosmos-io.github.io/website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kosmos-io.github.io/website/v0.2.0/tutorials/mcn-connectivity"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Multi-cluster Network Connectivity | Kosmos"><meta data-rh="true" name="description" content="The Clusterlink design of the Kosmos multi-cluster solution aims to interconnect the nodes and resources of multiple Kubernetes clusters, forming a unified resource pool."><meta data-rh="true" property="og:description" content="The Clusterlink design of the Kosmos multi-cluster solution aims to interconnect the nodes and resources of multiple Kubernetes clusters, forming a unified resource pool."><link data-rh="true" rel="icon" href="/website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/mcn-connectivity"><link data-rh="true" rel="alternate" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/mcn-connectivity" hreflang="en"><link data-rh="true" rel="alternate" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/mcn-connectivity" hreflang="x-default"><link rel="stylesheet" href="/website/assets/css/styles.e896f8c2.css">
<script src="/website/assets/js/runtime~main.a16ccbac.js" defer="defer"></script>
<script src="/website/assets/js/main.184346e0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/website/"><div class="navbar__logo"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kosmos</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/website/v0.2.0/getting-started/introduction">Documentation</a><a class="navbar__item navbar__link" href="/website/blog">Examples</a><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/getting-started/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/quick-start">Quick Start</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mcs-discovery">Multi-cluster Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mc-scheduler">Multi-cluster Scheduler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/website/v0.2.0/tutorials/mcn-connectivity">Multi-cluster Network Connectivity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/pv-pvc-dynamic-storage">Multi-cluster PV/PVC Dynamic Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/exe-and-log">Design of EXE and Log in Kosmos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/node-not-ready">Kosmos Node NotReady</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/ipsec-network">IPsec Cross-cluster Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/application-migration">Application Migration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/k8s-in-k8s">Kubernetes in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/distribution-policy">Distribution Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/leaf-node-generate-rules">Leaf Node Generate Rules</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Multi-cluster Network Connectivity</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Multi-cluster Network Connectivity</h1>
<p>The Clusterlink design of the Kosmos multi-cluster solution aims to interconnect the nodes and resources of multiple Kubernetes clusters, forming a unified resource pool.
One of the foundations for achieving this is the need to build a multi-cluster network architecture to meet the communication requirements between different clusters.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-cluster-container-network-solution">Multi-cluster Container Network Solution<a href="#multi-cluster-container-network-solution" class="hash-link" aria-label="Direct link to Multi-cluster Container Network Solution" title="Direct link to Multi-cluster Container Network Solution">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h3>
<p>Clusterlink includes two network modes: Gateway and P2P. In the Gateway mode, when a data packet is sent by a Pod on the left, it first goes through the vx-local tunnel within the cluster to reach the Gateway node of that cluster.
It then traverses the cross-cluster tunnel to reach the counterpart cluster.
Once the data packet arrives at the counterpart cluster, it is handled by the CNI and follows the single-cluster network to reach the target Pod.
This mode has its advantages and disadvantages.
The advantage is that each cluster only needs one node (or two for high availability) to provide external access, making it suitable for multi-cloud and hybrid cloud scenarios.
The disadvantage is that due to the longer network path, there is a certain performance loss.
To address this issue, Clusterlink provides the P2P mode, which is suitable for scenarios with higher network performance requirements.
In this mode, the data packets are directly sent to the node where the counterpart Pod is located.
Additionally, the P2P and Gateway modes can be used in combination.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="design">Design<a href="#design" class="hash-link" aria-label="Direct link to Design" title="Direct link to Design">​</a></h3>
<p>The architecture of the Kosmos multi-cluster network Gateway solution is as follows:</p>
<p><img decoding="async" loading="lazy" alt="MCN GW_Architecture.png" src="/website/assets/images/MCN_GW_Architecture-ad8eb15c31035ee0af215d29bceb17cf.png" width="1019" height="287" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>NOTE</div><div class="admonitionContent_BuS1"><p>It provides strong compatibility, requiring only one node per cluster (or two for high availability) to provide external access, making it suitable for cross-cloud scenarios.</p></div></div>
<p>The architecture of the Kosmos multi-cluster network P2P solution is as follows:</p>
<p><img decoding="async" loading="lazy" alt="MCN P2P_Architecture.png" src="/website/assets/images/MCN_P2P_Architecture-9554e1fd1efbac70fe5576731eb95ed3.png" width="1019" height="310" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>NOTE</div><div class="admonitionContent_BuS1"><p>It has shorter network paths and better performance, making it suitable for fully interconnected Underlay scenarios.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="install-kosmos">Install Kosmos<a href="#install-kosmos" class="hash-link" aria-label="Direct link to Install Kosmos" title="Direct link to Install Kosmos">​</a></h4>
<p>Refer to the Kosmos Quick Start documentation <a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer">https://github.com/kosmos-io/kosmos</a> and enable the ClusterLink module for multi-cluster networking. Using the kosmosctl tool:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kosmosctl install --cni calico --default-nic eth0 (We build a network tunnel based on the network interface value passed by the arg &quot;default-nic&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="join-the-leaf-cluster">Join the Leaf Cluster<a href="#join-the-leaf-cluster" class="hash-link" aria-label="Direct link to Join the Leaf Cluster" title="Direct link to Join the Leaf Cluster">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kosmosctl join cluster --name cluster1 --kubeconfig ~/kubeconfig/cluster1-kubeconfig --cni calico --default-nic eth0 --enable-link</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="across-cluster-l3-network-connectivity">Across Cluster L3 Network Connectivity<a href="#across-cluster-l3-network-connectivity" class="hash-link" aria-label="Direct link to Across Cluster L3 Network Connectivity" title="Direct link to Across Cluster L3 Network Connectivity">​</a></h3>
<p>To achieve cross-cluster L3 network connectivity in Kosmos, at least two different cluster nodes from each cluster need to be able to communicate with each other at the host machine network level, and the clusters must be correctly deployed and support VXLAN or IPSec technologies.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-mode">Gateway Mode<a href="#gateway-mode" class="hash-link" aria-label="Direct link to Gateway Mode" title="Direct link to Gateway Mode">​</a></h4>
<p>In each Kubernetes cluster within the Kosmos federation, one node is elected as the Gateway (GW) node using the Elector module.
The GW nodes of the two clusters communicate through the vx-bridge tunnel (created by Kosmos) to establish connectivity.
Within each cluster, routing is handled by the GW node.
Compared to the P2P mode, the GW mode has slightly lower network performance due to the additional packet encapsulation and decapsulation at the GW node.
However, the advantage is that the routing table and FDB table of the cluster nodes can remain almost the same as before.
Therefore, the GW mode is suitable for larger-scale multi-cluster scenarios where network performance is not critical.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="p2p-mode">P2P Mode<a href="#p2p-mode" class="hash-link" aria-label="Direct link to P2P Mode" title="Direct link to P2P Mode">​</a></h4>
<p>In the P2P mode, there is no need to use the Elector module.
Kosmos creates vx-bridge interfaces on all nodes of each cluster to achieve direct container network communication between nodes of different clusters.
The network performance in this mode is almost the same as in a single Kubernetes cluster.
However, in the P2P mode, every node in the cluster needs to configure access rules for all nodes in the Kosmos federation, resulting in larger routing and FDB table sizes.
Therefore, the P2P mode is suitable for scenarios that require higher network performance but have a smaller number of nodes in each cluster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="starting-clusterlink">Starting ClusterLink<a href="#starting-clusterlink" class="hash-link" aria-label="Direct link to Starting ClusterLink" title="Direct link to Starting ClusterLink">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-p2p-mode">Using P2P Mode<a href="#using-p2p-mode" class="hash-link" aria-label="Direct link to Using P2P Mode" title="Direct link to Using P2P Mode">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Complete the steps in sections &#x27;Install Kosmos&#x27; &amp; &#x27;Join the Leaf Cluster&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check if the clusters resource has been created correctly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@kosmos-control-cluster yaml]# kubectl --kubeconfig config-14 get clusters.kosmos.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                     NETWORK_TYPE   IP_FAMILY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster38                p2p            all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster   p2p            all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check if the clusternodes resource has been created correctly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@kosmos-control-cluster yaml]# kubectl get clusternodes.kosmos.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                         ROLES         INTERFACE    IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster38-001                              bond0.1820   10.*.*.38</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster38-002                              bond0.1820   10.*.*.39</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster38-003                              bond0.1830   10.*.*.94</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster38-004                [&quot;gateway&quot;]   bond0.1830   10.*.*.95</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-001                 bond0.1820   10.*.*.14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-002                 bond0.1820   10.*.*.15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-003   [&quot;gateway&quot;]   bond0.1565   10.*.*.38</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-004                 bond0.1565   10.*.*.31</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-005                 bond0.1565   10.*.*.32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-006                 bond0.1565   10.*.*.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-007                 bond0.1565   10.*.*.37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check if the nodeconfigs resource has been created correctly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@kosmos-control-cluster yaml]# kubectl get nodeconfigs.kosmos.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                         AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster38-001                14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster38-002                14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster38-003                14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster38-004                14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-001   48d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-002   48d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-003   49d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-004   49d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-005   45d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-006   45d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-control-cluster-007   45d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-test-pods">Create Test Pods<a href="#create-test-pods" class="hash-link" aria-label="Direct link to Create Test Pods" title="Direct link to Create Test Pods">​</a></h4>
<p>Verify the cross-cluster container network connectivity by creating Pods in the kosmos-control-cluster and cluster38 clusters.
To ensure the containers have common network utilities such as Ping and Curl, use the clusterlink-floater image.
More details about the Floater feature will be provided in subsequent sections. Here is a sample YAML to create the Pods:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: clusterlink-floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kosmos-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: clusterlink-floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - apiGroups: [&#x27;*&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resources: [&#x27;*&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    verbs: [&quot;*&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - nonResourceURLs: [&#x27;*&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    verbs: [&quot;get&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: clusterlink-floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: clusterlink-floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: clusterlink-floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    namespace: kosmos-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: clusterlink-floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kosmos-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: clusterlink-floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: clusterlink-floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hostNetwork: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serviceAccountName: clusterlink-floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: ghcr.io/kosmos-io/clusterlink-floater:v0.2.0-lts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - clusterlink-floater</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        securityContext:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          privileged: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - name: &quot;PORT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            value: &quot;8889&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - name: &quot;ENABLE_ANALYSIS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            value: &quot;false&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      affinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nodeAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nodeSelectorTerms:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                - key: kosmos.io/exclude</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  operator: DoesNotExist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tolerations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - effect: NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operator: Exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - key: CriticalAddonsOnly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operator: Exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - effect: NoExecute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        operator: Exists</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>NOTE</div><div class="admonitionContent_BuS1"><p>The provided test case in this section can only check the container network connectivity between nodes in two clusters.
To quickly test all nodes in the cluster, please refer to section 5.</p></div></div>
<p>Make sure the Pods are running successfully in the kosmos-control-cluster and cluster38 clusters:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@kosmos-control-cluster yaml]# kubectl -n kosmos-system get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                              READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-6qq4v                           1/1     Running   0          15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-6v9jm                           1/1     Running   0          15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-7zpf5                           1/1     Running   0          15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-84d68                           1/1     Running   0          15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-dj9q2                           1/1     Running   0          26h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-r2zj4                           1/1     Running   0          15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-vlh2x                           1/1     Running   0          3d3h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-controller-manager-6774ddd58b-bcn7s   1/1     Running   0          15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-elector-6b597b44f7-jrbg6              1/1     Running   0          15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-elector-6b597b44f7-mj882              1/1     Running   0          15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-floater-7dcb47579-lddgc               1/1     Running   0          77s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-network-manager-6489597986-h74m4      1/1     Running   0          15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clustertree-cluster-manager-6778bd7b6c-mwhpj      1/1     Running   0          5h45m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-operator-c88898f66-b8mjl                   1/1     Running   0          15d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-scheduler-7dcfd94bf7-2km8m                 1/1     Running   0          8d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@cluster38 yaml]# kubectl -n kosmos-system get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                              READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-jsv2b                           1/1     Running   0          14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-qncxt                           1/1     Running   0          14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-rzngm                           1/1     Running   0          14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-agent-s252r                           1/1     Running   0          14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-controller-manager-77fbbd9f78-bz47t   1/1     Running   0          14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-elector-86b49775b5-x4gsp              1/1     Running   0          14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-elector-86b49775b5-z4lb5              1/1     Running   0          14d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterlink-floater-7dcb47579-jx85c               1/1     Running   0          16s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Get the IP addresses of the two Pods and enter the container of either Pod to execute the Ping command to verify the inter-cluster container network connectivity.
Here is an example:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@cluster38 yaml]# kubectl -n kosmos-system get pod clusterlink-floater-7dcb47579-jx85c -oyaml |grep ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ip: 10.*.*.253</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ip: fd11:1111:*:*:*:*:4573:f17d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@kosmos-control-cluster yaml]# kubectl -n kosmos-system exec -it clusterlink-floater-7dcb47579-lddgc -- sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/ # ping 10.*.*.253</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PING 10.*.*.253 (10.*.*.253): 56 data bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from 10.*.*.253: seq=0 ttl=62 time=0.592 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from 10.*.*.253: seq=1 ttl=62 time=0.362 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from 10.*.*.253: seq=2 ttl=62 time=0.388 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from 10.*.*.253: seq=3 ttl=62 time=0.373 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--- 10.*.*.253 ping statistics ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 packets transmitted, 4 packets received, 0% packet loss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">round-trip min/avg/max = 0.362/0.428/0.592 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/ # ping -6 fd11:1111:*:*:*:*:4573:f17d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PING fd11:1111:*:*:*:*:4573:f17d (fd11:1111:*:*:*:*:4573:f17d): 56 data bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from fd11:1111:*:*:*:*:4573:f17d: seq=0 ttl=62 time=0.679 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from fd11:1111:*:*:*:*:4573:f17d: seq=1 ttl=62 time=0.492 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from fd11:1111:*:*:*:*:4573:f17d: seq=2 ttl=62 time=0.406 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">64 bytes from fd11:1111:*:*:*:*:4573:f17d: seq=3 ttl=62 time=1.488 ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--- fd11:1111:*:*:*:*:4573:f17d ping statistics ---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 packets transmitted, 4 packets received, 0% packet loss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">round-trip min/avg/max = 0.406/0.766/1.488 ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="one-click-diagnostic-for-cluster-connectivity">One-Click Diagnostic for Cluster Connectivity<a href="#one-click-diagnostic-for-cluster-connectivity" class="hash-link" aria-label="Direct link to One-Click Diagnostic for Cluster Connectivity" title="Direct link to One-Click Diagnostic for Cluster Connectivity">​</a></h3>
<p>The Cluster Connectivity Diagnostic (Floater) feature was developed to address the challenge of continuously checking the network connectivity between multiple Kubernetes clusters when using Kosmos.
When the number of clusters is small, such as only two clusters, this task may not be difficult.
However, when the number of clusters reaches 5000 or even more, even the most enthusiastic operations personnel would find it nearly impossible to complete this task.</p>
<p>To address this, we designed the Floater feature, which floats on every node in a cluster.
Through the kosmosctl tool, you can diagnose the network connectivity between multiple Kubernetes clusters with just one command.
The architecture of the ClusterLink Floater is as follows:</p>
<p><img decoding="async" loading="lazy" alt="MCN Floater_Flow.png" src="/website/assets/images/MCN_Floater_Flow-5eacf7d674beab610c33fa93723b0c35.png" width="1261" height="836" class="img_ev3q"></p>
<p>The kosmosctl command line tool provides a one-click diagnostic command &quot;dr&quot; to easily validate the network connectivity between multiple Kubernetes clusters, including but not limited to host network, container network, and native cluster network.
Here is an example:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Verify cross-cluster host network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmosctl dr -r ghcr.io/kosmos-io/komos --src-kubeconfig root-config --dst-kubeconfig cluster38-config --host-network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify cross-cluster container network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmosctl dr -r ghcr.io/kosmos-io/komos --src-kubeconfig root-config --dst-kubeconfig cluster38-config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/v0.2.0/tutorials/multi-cluster-network.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-03-10T09:33:58.000Z">Mar 10, 2024</time></b> by <b>renxiangyu</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/website/v0.2.0/tutorials/mc-scheduler"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Multi-cluster Scheduler</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/website/v0.2.0/tutorials/pv-pvc-dynamic-storage"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multi-cluster PV/PVC Dynamic Storage</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#multi-cluster-container-network-solution" class="table-of-contents__link toc-highlight">Multi-cluster Container Network Solution</a><ul><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#design" class="table-of-contents__link toc-highlight">Design</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#across-cluster-l3-network-connectivity" class="table-of-contents__link toc-highlight">Across Cluster L3 Network Connectivity</a></li><li><a href="#starting-clusterlink" class="table-of-contents__link toc-highlight">Starting ClusterLink</a></li><li><a href="#one-click-diagnostic-for-cluster-connectivity" class="table-of-contents__link toc-highlight">One-Click Diagnostic for Cluster Connectivity</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Address Name<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>