<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-v0.2.0/tutorials/mc-scheduler" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Multi-cluster Scheduler | Kosmos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kosmos-io.github.io/website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kosmos-io.github.io/website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kosmos-io.github.io/website/v0.2.0/tutorials/mc-scheduler"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Multi-cluster Scheduler | Kosmos"><meta data-rh="true" name="description" content="After Kosmos join a member cluster, it will map a virtual node with the kosmos.io/node=true:Noschedule taint, so the Kubernetes default scheduler cannot schedule Pods to the virtual node (i.e, the member cluster)."><meta data-rh="true" property="og:description" content="After Kosmos join a member cluster, it will map a virtual node with the kosmos.io/node=true:Noschedule taint, so the Kubernetes default scheduler cannot schedule Pods to the virtual node (i.e, the member cluster)."><link data-rh="true" rel="icon" href="/website/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/mc-scheduler"><link data-rh="true" rel="alternate" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/mc-scheduler" hreflang="en"><link data-rh="true" rel="alternate" href="https://kosmos-io.github.io/website/v0.2.0/tutorials/mc-scheduler" hreflang="x-default"><link rel="stylesheet" href="/website/assets/css/styles.20bcec04.css">
<script src="/website/assets/js/runtime~main.8e85197a.js" defer="defer"></script>
<script src="/website/assets/js/main.0db9ee29.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/website/"><div class="navbar__logo"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/website/img/logo.svg" alt="Kosmos Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kosmos</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/website/v0.2.0/getting-started/introduction">Documentation</a><a href="https://kosmos-io.github.io/website/v0.2.0/quick-start" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Examples<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/getting-started/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/quick-start">Quick Start</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mcs-discovery">Multi-cluster Service Discovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/website/v0.2.0/tutorials/mc-scheduler">Multi-cluster Scheduler</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/mcn-connectivity">Multi-cluster Network Connectivity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/pv-pvc-dynamic-storage">Multi-cluster PV/PVC Dynamic Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/exe-and-log">Design of EXEC and Log in Kosmos</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/node-not-ready">Kosmos Node NotReady</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/ipsec-network">IPsec Cross-cluster Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/application-migration">Application Migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/tutorials/kubenest">kubenest</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/k8s-in-k8s">Kubernetes in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/distribution-policy">Distribution Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/leaf-node-generate-rules">Leaf Node Generate Rules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/website/v0.2.0/proposals/performance-testing">Kosmos Performance Testing</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Multi-cluster Scheduler</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Multi-cluster Scheduler</h1>
<p>After Kosmos join a member cluster, it will map a virtual node with the <code>kosmos.io/node=true:Noschedule</code> taint, so the Kubernetes default scheduler cannot schedule Pods to the virtual node (i.e, the member cluster).
After deploying the kosmos-scheduler, users can tolerate the <code>kosmos.io/node=true:Noschedule</code> taint through the <code>LeafNodeTaintToleration</code> scheduling plugin in kosmos-scheduler to achieve an indiscriminate mixed scheduling effect between member cluster and host cluster nodes.</p>
<p>For Pods with PV/PVC, you also need to configure the <code>LeafNodeVolumeBinding</code> scheduling plugin in kosmos-scheduler to directly use the virtual node with the <code>kosmos.io/node=true:Noschedule</code> taint during the storage volume binding process.</p>
<p>It should be noted that for different versions of Kubernetes, the scheduling module (Scheduler Framework) on which the published default scheduler depends will also change with the version. Currently, Kosmos has also adapted to the two versions (<code>release-1.21.5</code> and <code>release-1.26.3</code>).
The following verification part will be deployed and tested with release-1.21.5.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-cluster-scheduler-solution">Multi-cluster Scheduler Solution<a href="#multi-cluster-scheduler-solution" class="hash-link" aria-label="Direct link to Multi-cluster Scheduler Solution" title="Direct link to Multi-cluster Scheduler Solution">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h3>
<p>The Scheduler framework was first introduced through the <a href="https://link.zhihu.com/?target=https%3A//github.com/kubernetes/enhancements/tree/master/keps/sig-scheduling/624-scheduling-framework" target="_blank" rel="noopener noreferrer">624-scheduling-framework</a> proposal of kubernetes enhancements, mainly to achieve the following goals:</p>
<ul>
<li>Make scheduler more extendable.</li>
<li>Make scheduler core simpler by moving some of its features to plugins.</li>
<li>Propose extension points in the framework.</li>
<li>Propose a mechanism to receive plugin results and continue or abort based on the received results.</li>
<li>Propose a mechanism to handle errors and communicate them with plugins.</li>
</ul>
<p>For this purpose, the scheduler framework defines multiple extension points as follows:
<img decoding="async" loading="lazy" alt="MC_Scheduler.png" src="/website/assets/images/MC_Scheduler-4e0d264782f68e38b5d41dc36731c7fe.png" width="1366" height="613" class="img_ev3q"></p>
<p><code>LeafNodeTaintToleration</code> and <code>LeafNodeVolumeBinding</code> scheduling plugins in kosmos-scheduler are mainly optimized based on the <code>NodeTaintToleration</code> and <code>NodeVolumeBinding</code> scheduling plugins of the Kubernetes default scheduler.
<code>LeafNodeTaintToleration</code> plugin mainly adds tolerance to the <code>kosmos.io/node=true:Noschedule</code> taint in the virtual node in the <code>Filter extension point</code>.
<code>LeafNodeVolumeBinding</code> plugin mainly acts on the Filter, Reserve, Unreserved, and PreBind extension points, and directly passes the virtual node with the <code>kosmos.io/node=true:Noschedule</code> taint.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="install-kosmos">Install Kosmos<a href="#install-kosmos" class="hash-link" aria-label="Direct link to Install Kosmos" title="Direct link to Install Kosmos">​</a></h4>
<p>Refer to the Kosmos Quick Start documentation <a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer">https://github.com/kosmos-io/kosmos</a> and enable the ClusterLink module for multi-cluster networking. Using the kosmosctl tool:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kosmosctl install --cni calico --default-nic eth0 (We build a network tunnel based on the network interface value passed by the arg default-nic)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>NOTE</div><div class="admonitionContent_BuS1"><p>At least the clustertree module is deployed and join the leaf cluster correctly.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="join-the-leaf-cluster">Join the Leaf Cluster<a href="#join-the-leaf-cluster" class="hash-link" aria-label="Direct link to Join the Leaf Cluster" title="Direct link to Join the Leaf Cluster">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kosmosctl join cluster --name cluster1 --kubeconfig ~/kubeconfig/cluster1-kubeconfig --cni calico --default-nic eth0 --enable-link</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-kosmos-scheduler">Deploy Kosmos-scheduler<a href="#deploy-kosmos-scheduler" class="hash-link" aria-label="Direct link to Deploy Kosmos-scheduler" title="Direct link to Deploy Kosmos-scheduler">​</a></h3>
<ol>
<li>Configure scheduler and scheduling policy:</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># kosmos-scheduler scheduling policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: scheduler-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kosmos-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scheduler-config.yaml: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apiVersion: kubescheduler.config.k8s.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kind: KubeSchedulerConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    leaderElection:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      leaderElect: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resourceName: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resourceNamespace: kosmos-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - schedulerName: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        plugins:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          preFilter:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;VolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;LeafNodeVolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          filter:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;VolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;TaintToleration&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;LeafNodeTaintToleration&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;LeafNodeVolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          score:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;VolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          reserve:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;VolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;LeafNodeVolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          preBind:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            disabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;VolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enabled:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - name: &quot;LeafNodeVolumeBinding&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pluginConfig:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - name: LeafNodeVolumeBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              bindTimeoutSeconds: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># scheduler config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kosmos-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    component: scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      component: scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        component: scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: scheduler-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          configMap:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name: scheduler-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            defaultMode: 420</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          image: ghcr.io/kosmos-io/scheduler:0.0.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - --config=/etc/kubernetes/kube-scheduler/scheduler-config.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              cpu: 200m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - name: scheduler-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              readOnly: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              mountPath: /etc/kubernetes/kube-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          livenessProbe:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            httpGet:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              path: /healthz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              port: 10259</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              scheme: HTTPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            initialDelaySeconds: 15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            periodSeconds: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            failureThreshold: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          readinessProbe:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            httpGet:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              path: /healthz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              port: 10259</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              scheme: HTTPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      restartPolicy: Always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dnsPolicy: ClusterFirst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serviceAccountName: kosmos-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serviceAccount: kosmos-scheduler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Verify the kosmos-scheduler service:</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># kosmos-scheduler is created.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n kosmos-system get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                         READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-scheduler-8f96d87d7-ssxrx             1/1     Running   0          24s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="try-a-sample">Try a Sample<a href="#try-a-sample" class="hash-link" aria-label="Direct link to Try a Sample" title="Direct link to Try a Sample">​</a></h4>
<ol>
<li>
<p>Deploy openebs on the test cluster</p>
</li>
<li>
<p>Use case yaml（mysql-cluster.yaml）</p>
</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: test-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: my-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type: Opaque</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # root password is required to be specified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ROOT_PASSWORD: ${your_password}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ## application credentials that will be created at cluster bootstrap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # DATABASE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # USER:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # PASSWORD:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: MysqlCluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: test-mysql-cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: test-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  secretName: my-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: docker.io/percona:5.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mysqlVersion: &quot;5.7&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  podSpec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    affinity:         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      podAntiAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              mysql.presslabs.org/cluster: test-mysql-cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          topologyKey: kubernetes.io/hostname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumeSpec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      storageClassName: openebs-hostpath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      accessModes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - ReadWriteOnce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          storage: 1Gi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>Operation instructions</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># List all nodes in the host cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                       STATUS     ROLES                       AGE   VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmoscluster1-1           Ready      control-plane,master,node   21d   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmoscluster1-2           Ready      node                        21d   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-member2-cluster-1   Ready      agent                       24m   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kosmos-member2-cluster-2   Ready      agent                       24m   v1.21.5-eki.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Show the taint information on the virtual node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe node kosmos-member2-cluster-1  |grep Tai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Taints:             node.kubernetes.io/unreachable:NoExecute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe node kosmos-member2-cluster-2  |grep Tai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Taints:             node.kubernetes.io/unreachable:NoExecute</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Scheduling by the kosmos-scheduler (hybrid scheduling)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f  mysql-cluster.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Show instances (hybrid) scheduling result in host cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -owide -n test-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            READY   STATUS    RESTARTS   AGE   IP               NODE                       NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test-mysql-cluster-mysql-0      4/4     Running   0          3m    2409:xxxxx:8ac   kosmoscluster1-2           &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test-mysql-cluster-mysql-1      4/4     Running   0          2m    2409:xxxxx:8ae   kosmos-member2-cluster-1   &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Show instances (hybrid) scheduling result in member cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod -owide -n test-mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                            READY   STATUS    RESTARTS   AGE   IP               NODE                       NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test-mysql-cluster-mysql-1      4/4     Running   0          2m    2409:xxxxx:8ae   kosmos-member2-cluster-1   &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h3>
<p>You can see that kosmos-scheduler successfully schedules the Pods of the user instances to the host cluster and member clusters.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/v0.2.0/tutorials/multi-cluster-scheduler.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-02-29T04:30:13.000Z">Feb 29, 2024</time></b> by <b>ONE7live</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/website/v0.2.0/tutorials/mcs-discovery"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Multi-cluster Service Discovery</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/website/v0.2.0/tutorials/mcn-connectivity"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multi-cluster Network Connectivity</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#multi-cluster-scheduler-solution" class="table-of-contents__link toc-highlight">Multi-cluster Scheduler Solution</a><ul><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#deploy-kosmos-scheduler" class="table-of-contents__link toc-highlight">Deploy Kosmos-scheduler</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/getting-started/introduction">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/tutorials/mcs-discovery">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/website/v0.2.0/proposals/k8s-in-k8s">Proposals</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Address Name<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kosmos-io/kosmos" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>